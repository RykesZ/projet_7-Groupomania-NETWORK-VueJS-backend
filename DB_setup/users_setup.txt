CREATE TABLE users (
id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
firstname VARCHAR(255) NOT NULL,
lastname VARCHAR(255) NOT NULL,
email VARCHAR(255) NOT NULL,
password VARCHAR(255) NOT NULL,
birthdate DATE NOT NULL,
gender VARCHAR(6) NOT NULL,
imageUrl VARCHAR(255) NOT NULL,
publicationsCreated TEXT,
publicationsLiked TEXT,
publicationsMasked TEXT,
commentsCreated TEXT,
deleted BOOLEAN,
moderator BOOLEAN,
PRIMARY KEY (id),
CONSTRAINT UC_User UNIQUE (id, email)
)
ENGINE=INNODB;

DELIMITER |
CREATE TRIGGER before_update_user BEFORE UPDATE
ON users FOR EACH ROW
BEGIN
	IF NEW.firstname IS NULL
		THEN
			SET NEW.firstname = OLD.firstname;
	END IF;
	IF NEW.lastname IS NULL
		THEN
			SET NEW.lastname = OLD.lastname;
	END IF;
	IF NEW.email IS NULL
		THEN
			SET NEW.email = OLD.email;
	END IF;
	IF NEW.password IS NULL
		THEN
			SET NEW.password = OLD.password;
	END IF;
	IF NEW.birthdate IS NULL
		THEN
			SET NEW.birthdate = OLD.birthdate;
	END IF;
	IF NEW.gender IS NULL
		THEN
			SET NEW.gender = OLD.gender;
	END IF;
	IF NEW.imageUrl IS NULL
		THEN
			SET NEW.imageUrl = OLD.imageUrl;
	END IF;
END |
DELIMITER ;